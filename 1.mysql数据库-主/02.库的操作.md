# 02.库的操作

## 一、创建数据库

- 语法

  ```sql
  CREATE DATABASE [IF NOT EXISTS] db_name [create_apecification [,create_specification]...]
  ```

  前面我们已经提到过，创建数据库本质上就是创建了一个目录。

  首先我们进入`cd /var/lib/mysql`

  ![image-20230410124608864](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230410124608864.png)

  

  我们可以看到这些d开头的文件其实都是目录，用sql查询后发现确实如此。

  ![image-20230410124718280](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230410124718280.png)

  当我们又创建了一个新目录后，`sudo mkdir iamahwei`

  ![image-20230410124825431](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230410124825431.png)

  可以看到，sql语句也能查出。

- 删库（慎重！！！）

  ```sql
  drop database iamahwei;
  ```

  `drop`数据库就是相当于把该目录全部删掉

- 显示数据库创建时的详细信息

  ```
  show create database ahweiDB;
  ```

  ![image-20230414082755765](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414082755765.png)

  什么时候必须加反引号？

  ——和关键字冲突的时候！

  ![image-20230414083634300](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414083634300.png)

  这时就必须加反引号了：

  ![image-20230414083757675](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414083757675.png)

  那`/*!40100 DEFAULT CHARACTER SET latin1 */`是什么意思呢？

  ——不是注释！如果`mysql`版本大于4.01版本，默认会执行（前面创建语句后再拼接）后面的`sql`语句

- 注意：

  - MySQL大小写不敏感
  - 建库和建表时，名称建议都带上反引号（只是建议，就算你写的不规范，MySQL的词法语法优化那一层也会帮你规范）

## 二、字符集和校验规则

站在数据库的角度，将来都是以二进制的形式存。编码决定了它的存取、识别、对比的方式。

![image-20230414090424859](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414090424859.png)

- 查看系统默认字符集及校验规则

  ```sql
  show variables like 'character_set_database';
  ```

  ![image-20230414091320931](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414091320931.png)

  因为我们但是配置的就是`utf8`

  ![image-20230414091432855](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414091432855.png)

  保证我们存数据时，统一是`utf8`字符集

  ![image-20230414091649528](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414091649528.png)

  一般字符集和校验规则是匹配的。(指明字符集是什么，校验集MySQL会自动帮你匹配)

  ```sql
  show variables like 'collation_database';
  ```

  ![image-20230414091927578](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414091927578.png)

  校验集全部采用`utf8_general`

  ![image-20230414092115049](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414092115049.png)



查看系统中所支持的所有字符集

![image-20230414092429420](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414092429420.png)

![image-20230414092632974](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414092632974.png)

![image-20230414092618786](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414092618786.png)

当使用了`utf8`字符集的时候，默认校验集就会匹配到`utf8_general_ci`。

查看系统中所支持的所有校验集

![image-20230414092922571](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414092922571.png)

​				**两张表是互相匹配的**

所以，引入字符集和校验规则的概念后，创建数据库：

- 语法
  ```sql
  CREATE DATABASE [IF NOT EXISTS] db_name [create_specification [,create_specification] ...]
  
  create_specification:
  [DEFAULT] CHARACTER SET charset_name
  [DEFAULT] COLLATE collation_name
  ```

- 说明：
  
  - 大写的表示关键字
  - [] 是可选项
  - CHARACTER SET: 指定数据库采用的字符集
  - COLLATE: 指定数据库字符集的校验规则

如果创建数据库不指明，采用默认方案，这个默认方案最终会被写到数据库的目录里面的`db.opt`文件里

![image-20230414191951900](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414191951900.png)

![image-20230414191732980](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414191732980.png)

如果创建数据库字符集采用了`utf8`编码方式，那么这个方案会被写到`db.opt`文件里，并且校验集也会自动地匹配

![image-20230414192339312](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414192339312.png)

![image-20230414192402701](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414192402701.png)

当然，`character set `也可以写成`charset=`的方式

![image-20230414192736297](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414192736297.png)

![image-20230414192656172](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414192656172.png)

这次创建数据库带上校验集

​																																				  也可以写成`collate = utf8_bin`

![image-20230414193009952](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414193009952.png)

![image-20230414193024483](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414193024483.png)

**一个空的数据库里面的`db.opt`，就会指明字符集和编码集**

未来，除非数据库要备份到远端平台，否则不要带字符集（用默认的即可）。



- 校验规则对数据库的影响

  先建两个数据库

  ![image-20230414201328449](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414201328449.png)

  设置数据库的编码和校验规则，本质会影响谁？

  ——其实是影响对应的数据库内部的表，所对应的编码和校验规则。未来创建表的时候，若不指明，他会先去看，他所在的数据库的编码和校验规则是什么

  ```mermaid
  graph LR
  a[数据库]
  b[创建数据库的SQL语句]
  c[系统]
  d[表]
  e[创建表的SQL语句]
  f[数据库]
  a-->b
  a-->c
  d-->e
  d-->f
  root[编码和校验规则]
  root-->a
  root-->d
  
  ```

  ```sql
  use 数据库名
  ```

  相当于`cd  `，进入某个数据库的目录下

  ![image-20230414195831216](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414195831216.png)

  创建表：

  ![image-20230414200435713](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414200435713.png)

  查看表结构：

  ![image-20230414200509488](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414200509488.png)

  向表中插入数据：

  ![image-20230414200723804](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414200723804.png)

  查看表的内容：

  ![image-20230414200802022](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414200802022.png)

  查找：

  ![image-20230414200953981](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414200953981.png)

  至此，我们可以发现：如果校验规则是`utf8_general_ci`的，查询比较时会忽略大小写。

  切换到`bin_db`数据库中：

  ![image-20230414201545982](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414201545982.png)

  重复gc_db中的插入过程后，查询：

  ![image-20230414201924666](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414201924666.png)

  发现，如果校验规则为`utf8_bin`则会严格匹配大小写。

  若时间久了，忘记在哪个数据库下了，可以使用`select database()`来查看，就好像`pwd`命令一样。

  ![image-20230414202239188](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414202239188.png)

  排序也会受影响：排序的本质——比较！

  ![image-20230414203023730](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414203023730.png)

  忽略大小写后mysql已经区分不了c和C谁大。所以就按照原始表结构来。

  ![image-20230414202657305](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414202657305.png)

## 三、操纵数据库

- 查看数据库

  ![image-20230414203936366](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414203936366.png)

- 显示创建语句

  ![image-20230414204259004](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414204259004.png)

- 删库

  ```sql
  DROP DATABASE [IF EXISTS] db_ name;
  ```

  执行删除之后的结果:

  - 数据库内部看不到对应的数据库

  - 对应的数据库文件夹被删除，级联删除，里面的数据表全部被删

    **注意：不要随意删除数据库**

- 修改数据库

  - 修改字符集

    ![image-20230414210122072](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414210122072.png)

    发现校验规则也自动匹配上了。

    ![image-20230414205541498](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414205541498.png)

    当然也可以这样改：

    ![image-20230414210309922](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414210309922.png)

    ![image-20230414210410214](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414210410214.png)

**Mysql不支持修改数据库名字**

- 备份和恢复

  ```sql
  mysqldump -P3306 -u root -p 密码 -B 数据库名 > 数据库备份存储的文件路径
  ```

  重定向到`bin_db.sql`

  ![image-20230414212757515](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414212757515.png)

![image-20230414212550030](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414212550030.png)

打开文件看一下：

![image-20230414213329238](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414213329238.png)

发现里面都是我们输过的sql语句。

**数据库备份：**

- 对数据做备份
- 对操作语句做备份

将来把这些sql语句执行一遍，不就得到数据库了吗？

![image-20230414214335754](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414214335754.png)

- 注意事项：

  - 如果备份的不是整个数据库，而是其中的一张表，怎么做?

    ```sql
    mysqldump -u root -p 数据库名 表名1 表名2 >   .sql
    ```

  - 同时备份多个数据库

    ```sql
    mysqldump -u root -p -B 数据库名1 数据库名2 ... > 数据库存放路径
    ```

  - 如果备份一个数据库时，没有带上-B参数， 在恢复数据库时，需要先创建空数据库，然后使用数据库，再使用source来还原

- 查看连接情况：

  查看有多少个人链接数据库

  ```sql
  show processlist 
  ```

  ![image-20230414215102434](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414215102434.png)

  用root再登陆一个：

  ![image-20230414215250118](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230414215250118.png)

  可以告诉我们当前有哪些用户连接到我们的MySQL，如果查出某个用户不是你正常登陆的，很有可能你的数据库被人入侵了。以后大家发现自己数据库比较慢时，可以用这个指令来查看数据库连接情况。
