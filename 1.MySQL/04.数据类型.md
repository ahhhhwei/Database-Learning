# 数据类型

## 一、数据类型分类

![image-20230418193540816](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230418193540816.png)

## 二、数值类型

![image-20230418193957187](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230418193957187.png)

### 1.tinyint类型

```sql
mysql> create table t1(
    -> num tinyint
    -> );
```

![image-20230418194623469](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230418194623469.png)

数值越界测试：

```sql
mysql> insert into t1 values(127);
Query OK, 1 row affected (0.03 sec)

mysql> insert into t1 values(-128);
Query OK, 1 row affected (0.01 sec)

mysql> insert into t1 values(-1);
Query OK, 1 row affected (0.01 sec)

mysql> insert into t1 values(1);
Query OK, 1 row affected (0.01 sec)

mysql> select * from t1;
+------+
| num  |
+------+
|  127 |
| -128 |
|   -1 |
|    1 |
+------+
4 rows in set (0.00 sec)
```

$$[-128,127]$$范围内都可以插入。

```sql
mysql> insert into t1 values(-129);
ERROR 1264 (22003): Out of range value for column 'num' at row 1
```

超出范围插入失败。

> C语言中，如果数值越界，编译器会截断，并给出`warning`，但再`Mysql`这里，如果插入的数值不符合要求，`Mysql`直接终止操作！
>
> 数据类型在Mysql这里，除了能满足各种应用场景，还有一个特别重要的用途：数据类型的本质就是一种**约束**！

说明：

- 在`MySQL`中，整型可以指定是有符号的和无符号的，默认是有符号的。
- 可以通过`UNSIGNED`来说明某个字段是无符号的

创建一个无符号的`tinyint`

```sql
mysql> create table t2 (num tinyint unsigned);
Query OK, 0 rows affected (0.08 sec)
```

![image-20230418200904903](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230418200904903.png)

> 注意：尽量不使用unsigned，对于int类型可能存放不下的数据，int unsigned同样可能存放不下，与其如此，还不如设计时，将int类型提升为bigint类型。如果非常确定数据范围，比如人类年龄，则忽略这条注意。

### 2.bit类型

#### 2.1基本语法

$$bit[(M)] $$: 位字段类型。M表示每个值的位数，范围从1到64。如果M被忽略，默认为1。

```sql
mysql> create table t3(
    -> id int,
    -> a bit(8)
    -> );
Query OK, 0 rows affected (0.13 sec)
```

```sql
mysql> insert into t3 values(10, 10);
Query OK, 1 row affected (0.03 sec)

mysql> insert into t3 values(10, 255);
Query OK, 1 row affected (0.01 sec)

mysql> insert into t3 values(10, 256);
ERROR 1406 (22001): Data too long for column 'a' at row 1
mysql> insert into t3 values(10, 11111111);
ERROR 1406 (22001): Data too long for column 'a' at row 1
```

```sql
mysql> select * from t3;
+------+------------+
| id   | a          |
+------+------------+
|   10 | 0x0A       |
|   10 | 0xFF       |
+------+------------+
2 rows in set (0.00 sec)
```

比如性别设置：

```sql
mysql> create table t4(
    -> name varchar(32),
    -> gender bit(1)
    -> );
    Query OK, 0 rows affected (0.09 sec)

mysql> insert into t4 values('阿伟', 1);
Query OK, 1 row affected (0.01 sec)

mysql> insert into t4 values('阿薇', 0);
Query OK, 1 row affected (0.01 sec)
```

```sql
mysql> select * from t4;
+--------+----------------+
| name   | gender         |
+--------+----------------+
| 阿伟   | 0x01           |
| 阿薇   | 0x00           |
+--------+----------------+
2 rows in set (0.00 sec)
```

同样的，也可以查询出来：

```sql
mysql> select * from t4 where gender = 1;
+--------+----------------+
| name   | gender         |
+--------+----------------+
| 阿伟   | 0x01           |
+--------+----------------+
1 row in set (0.00 sec)
```

### 3.小数类型

#### 3.1 float

- 语法：

  ```sql
  float[(m, d)] [unsigned] : M指定显示长度，d指定小数位数，占用空间4个字节
  ```

  先用`float`建一张表：

  ```sql
  mysql> create table t5(
      -> id int,
      -> salary float(4,2)
      -> );
  ```

  小数：float(4,2)表示的范围是-99.99 ~ 99.99，MySQL在保存值时会进行四舍五入。

  ![image-20230418204433773](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230418204433773.png)

  ![image-20230418205107819](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230418205107819.png)

  -99.991，多的这点会被拿掉。

  把表清空后，试一下无符号数：

  ```sql
  mysql> delete from t5 where id = 1;
  Query OK, 8 rows affected (0.01 sec)
  
  mysql> alter table t5 modify salary float(4, 2) unsigned;
  Query OK, 0 rows affected, 2 warnings (0.13 sec)
  Records: 0  Duplicates: 0  Warnings: 2
  
  mysql> insert into t5 (id, salary) values (1, -99.99);
  ERROR 1264 (22003): Out of range value for column 'salary' at row 1
  mysql> insert into t5 (id, salary) values (1, -0.0);
  Query OK, 1 row affected (0.01 sec)
  ```

#### 3.2 decimal

- 语法

  ```sql
  decimal(m, d) [unsigned] : 定点数m指定长度，d表示小数点的位数
  ```

  - decimal(5,2) 表示的范围是 -999.99 ~ 999.99
  - decimal(5,2) unsigned 表示的范围 0 ~ 999.99

  decimal和float很像，但是有区别: float和decimal表示的精度不一样

  ```sql
  mysql> create table t6(
      -> id int,
      -> salary float(10, 8),
      -> salary2 decimal(10, 8)
      -> );
  Query OK, 0 rows affected, 1 warning (0.06 sec)
  ```

  ![image-20230418210419419](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230418210419419.png)

  同插入23.12345612这个数字：

  ```sql
  mysql> insert into t6 values (1, 23.12345612, 23.12345612);
  Query OK, 1 row affected (0.03 sec)
  ```

  ![image-20230418210519493](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230418210519493.png)

  发现decimal的精度更准确，因此如果我们希望某个数据表示高精度，选择decimal

## 三、字符串类型

### 1. char

- 语法

  ```sql
  char(L): 固定长度字符串，L是可以存储的长度，单位为字符，最大长度值可以为255
  ```

  ```sql
  mysql> create table t8(
      -> id int,
      -> name char(256)
      -> );
  ERROR 1074 (42000): Column length too big for column 'name' (max = 255); use BLOB or TEXT instead
  ```

  **256超过最大范围，建表失败**

  ```sql
  mysql> create table t8( id int, name char(255) );
  Query OK, 0 rows affected (0.06 sec)
  ```

- 案例

  建表：

  ```sql
  mysql> create table t7(
      -> id int,
      -> name char(2)
      -> );
  Query OK, 0 rows affected (0.06 sec)
  
  mysql> desc t7;
  +-------+---------+------+-----+---------+-------+
  | Field | Type    | Null | Key | Default | Extra |
  +-------+---------+------+-----+---------+-------+
  | id    | int     | YES  |     | NULL    |       |
  | name  | char(2) | YES  |     | NULL    |       |
  +-------+---------+------+-----+---------+-------+
  2 rows in set (0.00 sec)
  ```

  插入：

  ```sql
  mysql> insert into t7 values(1, 'ah');
  Query OK, 1 row affected (0.03 sec)
  
  mysql> insert into t7 values(1, 'wei');
  ERROR 1406 (22001): Data too long for column 'name' at row 1
  mysql> insert into t7 values(1, 'a');
  Query OK, 1 row affected (0.01 sec)
  
  mysql> insert into t7 values(1, '');
  Query OK, 1 row affected (0.02 sec)
  
  mysql> insert into t7 values(1, '中');
  Query OK, 1 row affected (0.01 sec)
  
  mysql> insert into t7 values(1, '中国');
  Query OK, 1 row affected (0.01 sec)
  
  mysql> insert into t7 values(1, '中国人');
  ERROR 1406 (22001): Data too long for column 'name' at row 1
  ```

  ```sql
  mysql> select * from t7;
  +------+--------+
  | id   | name   |
  +------+--------+
  |    1 | ah     |
  |    1 | a      |
  |    1 |        |
  |    1 | 中     |
  |    1 | 中国   |
  +------+--------+
  5 rows in set (0.00 sec)
  ```

  **Mysql中的一个字符可以指`ab#_1.]`这样的，也可以是一个汉字。**

### 2. varchar

- 语法

  ```sql
  varchar(L): 可变长度字符串，L表示字符长度，最大长度65535个字节
  ```

- 案例

  建表：

  ```sql
  mysql> create table t9(
      -> id int,
      -> name varchar(6)
      -> );
  Query OK, 0 rows affected (0.08 sec)
  
  mysql> desc t9;
  +-------+------------+------+-----+---------+-------+
  | Field | Type       | Null | Key | Default | Extra |
  +-------+------------+------+-----+---------+-------+
  | id    | int        | YES  |     | NULL    |       |
  | name  | varchar(6) | YES  |     | NULL    |       |
  +-------+------------+------+-----+---------+-------+
  2 rows in set (0.00 sec)
  ```

  插入：

  ```sql
  mysql> insert into t9 values (1, 'ahwei');
  Query OK, 1 row affected (0.02 sec)
  
  mysql> insert into t9 values (1, 'ahhwei');
  Query OK, 1 row affected (0.01 sec)
  
  mysql> insert into t9 values (1, 'ahhhwei');
  ERROR 1406 (22001): Data too long for column 'name' at row 1
  ```

  **一个字符串长度有上限和它是变长的并不直接冲突**

  - 说明：

    关于`varchar(len)`,`len`到底是多大，这个`len`值，和表的编码密切相关：

    - `varchar`长度可以指定为0到65535之间的值，但是有1 - 3 个字节用于记录数据大小，所以说有效字节数是65532。
    - 当我们的表的编码是`utf8`时，`varchar(n)`的参数`n`最大值是65532/3=21844。(因为`utf`中，一个字符占用3个字节)，如果编码是`gbk`，`varchar(n)`的参数`n`最大是65532/2=32766（因为`gbk`中，一个字符占用2字节）。

  ```sql
  mysql> create table t10(
      -> name varchar(21844)
      -> )charset = utf8;
  Query OK, 0 rows affected, 1 warning (0.07 sec)
  ```

  ```sql
  mysql> create table t11(
      -> name varchar(21845)
      -> )charset = utf8;
  ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535. This includes storage overhead, check the manual. You have to change some columns to TEXT or BLOBs
  ```

### 3. char和varchar的比较

![image-20230419092708233](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230419092708233.png)

如何选择定长或变长字符串？

- 如果数据确定长度都一样，就使用定长`(char)`，比如：身份证，手机号，md5
- 如果数据长度有变化,就使用变长`(varchar)`, 比如：名字，地址，但是你要保证最长的能存的进去。
- 定长的磁盘空间比较浪费，但是效率高。
- 变长的磁盘空间比较节省，但是效率低。
- 定长的意义是，直接开辟好对应的空间
- 变长的意义是，在不超过自定义范围的情况下，用多少，开辟多少。

## 四、日期和时间类型

- 常用的日期有如下三个：
  - date :日期 `yyyy-mm-dd` ，占用三字节
  - datetime 时间日期格式 `yyyy-mm-dd HH:ii:ss` 表示范围从 1000 到 9999 ，占用八字节
  - timestamp ：时间戳，从1970年开始的 `yyyy-mm-dd HH:ii:ss` 格式和 datetime 完全一致，占用四字节

案例：

```sql
//创建表
mysql> create table birthday (t1 date, t2 datetime, t3 timestamp);
Query OK, 0 rows affected (0.01 sec)

//插入数据：
mysql> insert into birthday(t1,t2) values('1997-7-1','2008-8-8 12:1:1'); --插入两种时间
Query OK, 1 row affected (0.00 sec)
mysql> select * from birthday;
+------------+---------------------+---------------------+
| t1 | t2 | t3 |
+------------+---------------------+---------------------+
| 1997-07-01 | 2008-08-08 12:01:01 | 2023-04-19 14:28:55 | --添加数据时，时间戳自动补上当前时间
+------------+---------------------+---------------------+
//更新数据：
mysql> update birthday set t1='2000-1-1';
Query OK, 1 row affected (0.00 sec)
Rows matched: 1 Changed: 1 Warnings: 0
mysql> select * from birthday;
+------------+---------------------+---------------------+
| t1 | t2 | t3 |
+------------+---------------------+---------------------+
| 2000-01-01 | 2008-08-08 12:01:01 | 2023-04-19 14:32:09 | -- 更新数据，时间戳会更新成当前时间
+------------+---------------------+---------------------+
```

## 五、enum和set

- 语法

  ```sql
  enum：枚举，“单选”类型；
  enum('选项1','选项2','选项3',...);
  ```

  该设定只是提供了若干个选项的值，最终一个单元格中，实际只存储了其中一个值；而且出于效率考虑，这些值实际存储的是“数字”，因为这些选项的每个选项值依次对应如下数字：1,2,3,....最多65535个；当我们添加枚举值时，也可以添加对应的数字编号。

  ```sql
  set：集合，“多选”类型；
  set('选项值1','选项值2','选项值3', ...);
  ```

  该设定只是提供了若干个选项的值，最终一个单元格中，设计可存储了其中任意多个值；而且出于效率考虑，这些值实际存储的是“数字”，因为这些选项的每个选项值依次对应如下数字：1,2,4,8,16,32，....最多64个。

- 案例

  建表：

  ```sql
  mysql> create table if not exists votes (
      -> name varchar(48),
      -> gender enum('男', '女'),
      -> hobby set('唱', '跳', 'Rap', '篮球', 'Music')
      -> )engine=InnoDB default charset=utf8;
  Query OK, 0 rows affected, 1 warning (0.06 sec)
  ```

  ![image-20230419150411092](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230419150411092.png)

  插入：

  ```sql
  mysql> insert into votes values ('阿伟', '男', '唱');
  Query OK, 1 row affected (0.01 sec)
  
  mysql> insert into votes values ('毛哥', '男', '唱,跳,Rap'); --这里不能带有空格:'唱, 跳, Rap'
  Query OK, 1 row affected (0.01 sec)
  
  mysql> insert into votes values ('啊喂', '女', 'Music,Rap');-- 性别是枚举类型,不能:'男,女'
  Query OK, 1 row affected (0.01 sec)
  ```

  ![image-20230419150557015](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230419150557015.png)

  出于效率的考虑：

  ```sql
  mysql> insert into votes values ('王子', 1, 1);
  Query OK, 1 row affected (0.01 sec)
  
  mysql> select * from votes;
  +--------+--------+-------------+
  | name   | gender | hobby       |
  +--------+--------+-------------+
  | 阿伟   | 男     | 唱          |
  | 毛哥   | 男     | 唱,跳,Rap   |
  | 啊喂   | 女     | Rap,Music   |
  | 王子   | 男     | 唱          |
  +--------+--------+-------------+
  4 rows in set (0.00 sec)
  ```

  ```sql
  mysql> insert into votes values ('阿薇', 2, 3);
  Query OK, 1 row affected (0.01 sec)
  
  mysql> select * from votes;
  +--------+--------+-------------+
  | name   | gender | hobby       |
  +--------+--------+-------------+
  | 阿伟   | 男     | 唱          |
  | 毛哥   | 男     | 唱,跳,Rap   |
  | 啊喂   | 女     | Rap,Music   |
  | 王子   | 男     | 唱          |
  | 阿薇   | 女     | 唱,跳       |
  +--------+--------+-------------+
  ```

  可以看出：`enum`是对应123456的数字，而`set`对应的是位图：3$$\rightarrow$$11，即唱、跳。

  查询：

  ```sql
  mysql> select * from votes where hobby='唱';
  +--------+--------+-------+
  | name   | gender | hobby |
  +--------+--------+-------+
  | 阿伟   | 男     | 唱    |
  | 王子   | 男     | 唱    |
  +--------+--------+-------+
  2 rows in set (0.00 sec)
  ```

  **不能查出所有的爱好为'唱'的人**

  **集合查询使用`find_in_set`函数：**
  `find_in_set(sub,str_list)` ：如果 `sub` 在 `str_list` 中，则返回下标；如果不在，返回0；
  `str_list` 用逗号分隔的字符串。

  `select`在`mysql`中很强大：

  ```sql
  mysql> select 1;
  +---+
  | 1 |
  +---+
  | 1 |
  +---+
  1 row in set (0.00 sec)
  
  mysql> select 1+1;
  +-----+
  | 1+1 |
  +-----+
  |   2 |
  +-----+
  1 row in set (0.00 sec)
  
  mysql> select 1/1;
  +--------+
  | 1/1    |
  +--------+
  | 1.0000 |
  +--------+
  1 row in set (0.00 sec)
  
  mysql> select 1/0;
  +------+
  | 1/0  |
  +------+
  | NULL |
  +------+
  ```

  它可以调用表达式，返回表达式的结果。

  ```sql
  mysql> select find_in_set('a', 'a,b,c');
  +---------------------------+
  | find_in_set('a', 'a,b,c') |
  +---------------------------+
  |                         1 |
  +---------------------------+
  1 row in set (0.00 sec)
  
  mysql> select find_in_set('b', 'a,b,c');
  +---------------------------+
  | find_in_set('b', 'a,b,c') |
  +---------------------------+
  |                         2 |
  +---------------------------+
  1 row in set (0.00 sec)
  
  mysql> select find_in_set('c', 'a,b,c');
  +---------------------------+
  | find_in_set('c', 'a,b,c') |
  +---------------------------+
  |                         3 |
  +---------------------------+
  1 row in set (0.00 sec)
  
  mysql> select find_in_set('d', 'a,b,c');
  +---------------------------+
  | find_in_set('d', 'a,b,c') |
  +---------------------------+
  |                         0 |
  +---------------------------+
  1 row in set (0.00 sec)
  ```

  查询爱好有'唱'的人：

  使用函数，只要‘唱’在`hobby`里，返回值就为真。

  ```sql
  mysql> select * from votes where find_in_set('唱', hobby);
  +--------+--------+-------------+
  | name   | gender | hobby       |
  +--------+--------+-------------+
  | 阿伟   | 男     | 唱          |
  | 毛哥   | 男     | 唱,跳,Rap   |
  | 王子   | 男     | 唱          |
  | 阿薇   | 女     | 唱,跳       |
  +--------+--------+-------------+
  4 rows in set (0.00 sec)
  ```