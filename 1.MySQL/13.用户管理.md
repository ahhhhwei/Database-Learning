# 13.用户管理

如果我们只能使用`root`用户，这样存在安全隐患。这时，就需要使用`MySQL`的用户管理。

![image-20230605193849108](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230605193849108.png)

张三只能操纵`mytest`这个库，李四只能操纵`msg`这个库。如果给他们`root`账户，那他们就可以操纵所有的库,风险太大。

## 一、用户

### 1.用户信息

`MySQL`中的用户，都存储在系统数据库`mysql`的`user`表中

```sql
mysql> use mysql;
Database changed
mysql> select host,user,authentication_string from user;
+-----------+---------------+-------------------------------------------+
| host 	    | user		    | authentication_string					  |
+-----------+---------------+-------------------------------------------+
| localhost | root 		    | *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B |
| localhost | mysql.session | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |
| localhost | mysql.sys     | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |
+-----------+---------------+-------------------------------------------+
-- 可以通过desc user初步查看一下表结构
```

所有的用户管理工作，全部都是在这张表中进行！

所有用户管理工作对应的`sql`，本质其实都是对这个表进行增删查改。只要不嫌麻烦，直接在这个表上就可以完成用户创建等。

字段解释：

- `host`： 表示这个用户可以从哪个主机登陆，如果是`localhost`，表示只能从本机登陆 
- `user`： 用户名 
- `authentication_string`： 用户密码通过`password`函数加密后的 
- `*_priv`： 用户拥有的权限

### 2.创建用户

语法：

```sql
create user '用户名'@'登陆主机/ip' identified by '密码';
```

案例：

```sql
mysql> create user 'brother_cat'@'localhost' identified by '123456';
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
mysql> create user 'brother_cat'@'localhost' identified by 'Mshj@666';
Query OK, 0 rows affected (0.11 sec)

-- 此时便可以使用新账号新密码进行登陆啦
-- 备注：可能实际在设置密码的时候，因为mysql本身的认证等级比较高，一些简单的密码无法设置，会爆出如下报错：
-- ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
-- 解决方案：https://blog.csdn.net/zhanaolu4821/article/details/93622812
-- 查看密码设置相关要求：SHOW VARIABLES LIKE 'validate_password%';
-- 这个大家下来自己玩玩
-- 关于新增用户这里，需要大家注意，不要轻易添加一个可以从任意地方登陆的user。
```

![image-20230606190757950](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230606190757950.png)

### 3.删除用户

语法：

```sql
drop user '用户名'@'主机名'
```

示例：

```sql
mysql> select user,host,authentication_string from user;
+------------------+-----------+------------------------------------------------------------------------+
| user             | host      | authentication_string                                                  |
+------------------+-----------+------------------------------------------------------------------------+
| fsp              | %         | $A$005$2Ea U+^RAy1VF+BJNM.tgqlnVWx2r.yqpDHHlwzDrlOBKYuud9PG4.qF/4 |
| ahwei            | localhost | $A$005$U?V=Qt/'@k
                                                  FDzj(lLdlYMaKeHRGW0Vd.0lrFrUUl21iKoyi/3uSI6wxb5A |
| brother_cat      | localhost | $A$005$b^D#['*od+<pG%}lVizRhPbZnEGJoKz1cOIepGzzpRARZTsQXjxH3wVofTjRH7 |
| mysql.infoschema | localhost | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| mysql.session    | localhost | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE                              |
| mysql.sys        | localhost | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE                              |
| root             | localhost | *3A7A71F890413C0B661F424FD6728AFFCAA56D57                              |
+------------------+-----------+------------------------------------------------------------------------+
7 rows in set (0.01 sec)

mysql> drop user 'brother_cat'@'localhost';
Query OK, 0 rows affected (0.02 sec)

mysql> select user,host,authentication_string from user;
+------------------+-----------+------------------------------------------------------------------------+
| user             | host      | authentication_string                                                  |
+------------------+-----------+------------------------------------------------------------------------+
| fsp              | %         | $A$005$2Ea U+^RAy1VF+BJNM.tgqlnVWx2r.yqpDHHlwzDrlOBKYuud9PG4.qF/4 |
| ahwei            | localhost | $A$005$U?V=Qt/'@k
                                                  FDzj(lLdlYMaKeHRGW0Vd.0lrFrUUl21iKoyi/3uSI6wxb5A |
| mysql.infoschema | localhost | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |
| mysql.session    | localhost | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE                              |
| mysql.sys        | localhost | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE                              |
| root             | localhost | *3A7A71F890413C0B661F424FD6728AFFCAA56D57                              |
+------------------+-----------+------------------------------------------------------------------------+
6 rows in set (0.01 sec)

```

### 4.修改用户密码

——直接`update`也可以修改

- 语法：

  - 自己改自己密码

    ```sql
    set password=password('新的密码');
    ```

  - root用户修改指定用户的密码

    ```sql
    set password for '用户名'@'主机名'=password('新的密码');
    ```

## 二、数据库的权限

![image-20230606234036952](C:\Users\20848\AppData\Roaming\Typora\typora-user-images\image-20230606234036952.png)

### 1.给用户授权

刚创建的用户没有任何权限。需要给用户授权。

语法:

```sql
grant 权限列表 on 库.对象名 to '用户名'@'登陆位置' [identified by '密码']
```

说明：

- 权限列表，多个权限用逗号分开

  ```sql
  grant select on ...
  grant select, delete, create on ....
  grant all [privileges] on ... -- 表示赋予该用户在该对象上的所有权限
  ```

- `*.*`: 代表本系统中的所有数据库的所有对象（表，视图，存储过程等）
  `库.*`: 表示某个数据库中的所有数据对象(表，视图，存储过程等)
  `identified by`可选。 如果用户存在，赋予权限的同时修改密码,如果该用户不存在，就是创建用户

```sql
-- 备注：特定用户现有查看权限
mysql> show grants for 'ahwei'@'%';
+-----------------------------------------------+
| Grants for ahwei@%                              |
+-----------------------------------------------+
| GRANT USAGE ON *.* TO 'ahwei'@'%'               |
| GRANT ALL PRIVILEGES ON `test`.* TO 'ahwei'@'%' |
+-----------------------------------------------+
2 rows in set (0.00 sec)
mysql> show grants for 'root'@'%';
+-------------------------------------------------------------+
| Grants for root@% 									   |
+-------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION |
+-------------------------------------------------------------+
1 row in set (0.00 sec)
-- 注意：如果发现赋权限后，没有生效，执行如下指令：
flush privileges;
```

### 2.回收权限

语法：

```sql
revoke 权限列表 on 库.对象名 from '用户名'@'登陆位置'；
```
